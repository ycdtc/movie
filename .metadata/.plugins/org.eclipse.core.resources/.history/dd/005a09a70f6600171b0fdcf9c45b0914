<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="javascript/base.js"></script>
<link rel="stylesheet" href="stylesheet/base.css" />
<link rel="stylesheet" href="stylesheet/customer.css" />
</head>
<body>

</body>
<script>
var moviePath = "D:/data/movieinfo.txt";
var roomPath = "D:/data/roominfo.txt";
$(function(){
	var movies = dbSearch(moviePath, {"status":"present"});
	for(var i=0;i<movies.length;i++){
		$("body").append($("<img class='movie' id='"+ movies[i].movie +"' src='movie/"+ movies[i].movie +".jpg'/>"));
	}
	$("img").click(function(){
		$("body").empty();
		var movie = $(this).id;
		console.log(movie);
		var brands = dbGetValue(roomPath, "brand", {"movie":movie});
		for(var i=0;i<brands.length;i++){
			$("body").append($("<button>"+ brands[i] +"</button>"));
		}
		$("button").click(function(){
			$("body").empty();
			var brand = $(this).html();
			var times = dbGetValue(roomPath, "time", {"movie":movie,"brand":brand});
			for(var i=0;i<times.length;i++){
				$("body").append($("<button>"+ times[i] +"</button>"));
			}
			$("button").click(function(){
				$("body").empty();
				var time = $(this).html();
				var seats = dbSearch(roomPath, {"movie":movie,"brand":brand,"time":time});
				for(var i=0;i<seats.length;i++){
					for(var j=0;j<seats.length;j++){
						if(seats[i][j] == 0){
							$("body").append("<img class='seat' id='"+ i + "-" + j +"' src='empty.png'/>");
						}else{
							$("body").append("<img class='seat' id='"+ i + "-" + j +"' src='taken.png'/>");							
						}
						$("body").append("<br/>");
					}
				}
				$("img").click(function(){
					$(this).attr({"src":"taken.png"});
				});
				$("body").append("<button id='commit'>commit</button>");
				$("#commit").click(function(){
					for(var i=0;i<seats.length;i++){
						for(var j=0;j<seats.length;j++){
							if($("#" + i + "-" + j).attr("src") == 'taken.png'){
								seats[i][j] = 1;
							}
						}
					}					
					dbUpdate(roomPath, {"movie":movie,"brand":brand,"time":time},{"seats":seats});
				});
			});
		})		
	})
});


</script>
</html>